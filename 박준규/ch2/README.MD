# 🚀 2장: 내가 만든 프로그램의 속도를 알고 싶다

> 프로그램의 성능 저하 원인을 찾고, 정확하게 속도를 측정하는 방법을 알아봅니다.

---

## 💡 1. 성능 문제의 시작: 병목 지점 파악하기

시스템이 느리다면, 가장 먼저 **'병목 지점(Bottleneck)'** 을 찾아야 합니다.

- **프로파일링 (Profiling)**
  - **목적**: 개발 단계에서 시스템 내부의 문제를 상세히 분석하는 툴.
  - **주요 기능**:
    - **응답 시간**: 클래스 및 메서드 단위의 응답 시간 (`CPU 시간`, `대기 시간`) 측정.
    - **메모리**: `메모리 릭`, 불필요한 GC(Garbage Collection) 대상 객체 추적.
- **APM (Application Performance Management)**
  - **목적**: 운영 환경에서 서버의 성능을 실시간으로 진단하고 모니터링하는 툴.

---

## ⚙️ 2. `System` 클래스 제대로 활용하기

`System` 클래스의 모든 메서드는 `static`이며, 별도의 인스턴스 생성 없이 사용합니다.

### ✅ 유용한 메서드

- `System.arraycopy()`: 배열을 빠르고 효율적으로 복사할 때 사용합니다.
- `System.getProperty()` / `setProperty()`: JVM의 속성(Property)을 확인하거나 설정합니다.
- `System.getenv()`: 운영체제의 환경 변수(Environment Variable)를 조회합니다.

### ❌ 절대 사용하면 안 되는 메서드

- `System.gc()`: 명시적으로 GC를 호출하지만, 시스템 전체에 예측 불가능한 멈춤(Stop-the-world)을 유발할 수 있어 성능에 악영향을 줍니다.
- `System.exit()`: 실행 중인 JVM을 즉시 중지시킵니다. 정상적인 애플리케이션 흐름을 방해하므로 사용을 금합니다.
- `System.runFinalization()`: GC에 의해 수거될 객체의 `finalize()` 메서드 실행을 요청하지만, 실행 시점과 여부를 보장할 수 없어 사용하지 않는 것이 좋습니다.

---

## ⏱️ 3. 정밀한 시간 측정: `ms` vs `ns`

성능 측정의 기본은 시간 측정입니다. 목적에 맞는 메서드를 사용해야 합니다.

- **`System.currentTimeMillis()`**
  - **단위**: 밀리초 (`1/1,000`초)
  - **용도**: 현재 시각을 얻어올 때 사용합니다.
- **`System.nanoTime()`**
  - **단위**: 나노초 (`1/1,000,000` 밀리초)
  - **용도**: 두 코드 지점 사이의 **경과 시간**을 정밀하게 측정할 때 사용합니다.
    > ⚠️ 주의: 이 메서드는 현재 시각을 반환하는 것이 아니므로, 오늘 날짜를 알아내는 등의 용도로 사용해서는 안 됩니다.

---

## 📊 4. 신뢰성 있는 성능 측정: 벤치마킹 라이브러리

단순 시간 측정만으로는 JVM 워밍업 등의 변수 때문에 정확한 성능을 알기 어렵습니다. 이때 **JMH**와 같은 전문 벤치마킹 프레임워크를 사용하는 것이 좋습니다.

- **대표 라이브러리**: **JMH (Java Microbenchmark Harness)**, Caliper, JunitPerf 등

### JMH 주요 어노테이션

```java
// JMH 사용 예시
@BenchmarkMode(Mode.AverageTime)      // 평균 실행 시간 측정
@OutputTimeUnit(TimeUnit.NANOSECONDS) // 나노초 단위로 결과 출력
public class MyBenchmark {

    @Benchmark // 이 메서드의 성능을 측정
    public void testMethod() {
        // 성능을 측정할 코드
    }
}
```

- `@Benchmark`: 측정 대상 메서드를 지정합니다.
- `@BenchmarkMode`: 처리량, 평균 시간 등 측정 방식을 설정합니다.
- `@OutputTimeUnit`: 결과 값의 시간 단위를 지정합니다.
- **장점**: 여러 스레드를 이용한 동시성 성능 테스트가 가능합니다.

---

## 🎯 결론: 핵심 요약

1. **툴을 사용하라**: 프로젝트에 맞는 **프로파일링** 또는 **APM** 툴을 반드시 하나 이상 도입하여 성능을 지속적으로 관리해야 합니다.
2. **비교하고 선택하라**: 모든 툴은 장단점이 명확하므로, 프로젝트의 특성과 목적에 맞게 비교 후 합리적으로 선택해야 합니다.
3. **정밀하게 측정하라**: 미세한 성능 차이가 큰 결과를 만들 수 있습니다. 성능 측정 시에는 `currentTimeMillis`보다 `nanoTime`을 사용하여 경과 시간을 정확히 측정하는 습관을 들여야 합니다.
